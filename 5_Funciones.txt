create or replace 
function FN_AGREGAR_PRODUCTO (V_NOMBRE_PRODUCTO VARCHAR2, V_PRECIO_KILO	NUMBER, V_ORIGEN_PRODUCTO	VARCHAR2, V_CARGA	NUMBER,
                                                V_CALIDAD	VARCHAR2, V_CORREO_PRODUC	VARCHAR2) return number
IS

  CURSOR C_PRODUCTOR IS SELECT * FROM PRODUCTOR;
  V_PRODUCTOR C_PRODUCTOR%rowtype;
  V_IDPRODUC NUMBER;
  VF_CORREO BOOLEAN; 
  V_IDPRODUCTO NUMBER;
BEGIN

    VF_CORREO := FALSE;

    OPEN C_PRODUCTOR;
      LOOP
        FETCH C_PRODUCTOR INTO V_PRODUCTOR;
        
          IF V_PRODUCTOR.USUARIO_CORREO_USUARIO = V_CORREO_PRODUC
            THEN
            VF_CORREO := TRUE;
            V_IDPRODUC:= V_PRODUCTOR.ID_PRODUCTOR;
            EXIT;
          END IF;
        
        EXIT WHEN C_PRODUCTOR%NOTFOUND;
      END LOOP;
    CLOSE C_PRODUCTOR;


  IF VF_CORREO=TRUE
    THEN
    
    V_IDPRODUCTO:= SEC_PRODUCTOS.NEXTVAL;
    
    INSERT INTO PRODUCTO VALUES(
      V_IDPRODUCTO,
      V_NOMBRE_PRODUCTO,
      V_PRECIO_KILO,
      V_ORIGEN_PRODUCTO,
      V_CARGA,
      V_CALIDAD,
      V_IDPRODUC
    ); 
    
    RETURN V_IDPRODUCTO;
    
  END IF;

END;

-------------------

create or replace 
FUNCTION FN_CAMBIAR_PASS(V_CORREO VARCHAR, V_PASS VARCHAR, V_PASS2 VARCHAR) RETURN NUMBER
IS 

  CURSOR C_USUARIO IS SELECT * FROM USUARIO;
  V_USUARIO C_USUARIO%rowtype;
  VERIFICADOR NUMBER;

BEGIN 

    VERIFICADOR:=0;

    OPEN C_USUARIO;
      LOOP
        FETCH C_USUARIO INTO V_USUARIO;
        
          IF V_USUARIO.CORREO_USUARIO = V_CORREO AND V_USUARIO.CONTRASEÑA_USUARIO = V_PASS
            THEN
            
            VERIFICADOR:=1;
            
            EXIT;
          END IF;
        
        EXIT WHEN C_USUARIO%NOTFOUND;
      END LOOP;
    CLOSE C_USUARIO;
    
    IF VERIFICADOR = 1
      THEN
      
      UPDATE USUARIO SET
        CONTRASEÑA_USUARIO = V_PASS2
      WHERE CORREO_USUARIO = V_CORREO;
      
    END IF;
    
    RETURN VERIFICADOR;
      
END;


-----------------------------

create or replace 
function FN_LOGIN(V_CORREO varchar2, V_PASS varchar2) return NUMBER
IS 
  CURSOR C_USUARIO IS SELECT * FROM USUARIO;
  V_USUARIOS C_USUARIO%rowtype;
  
  VERIFICADOR NUMBER;
  
BEGIN

  VERIFICADOR:= 0;

  OPEN C_USUARIO;
    LOOP
      FETCH C_USUARIO INTO V_USUARIOS;
      
        IF V_USUARIOS.CORREO_USUARIO = V_CORREO AND v_USUARIOS.CONTRASEÑA_USUARIO = V_PASS
          THEN    
          
          VERIFICADOR:= V_USUARIOS.TIPO_USUARIO_ID_TIPO_USUARIO;         
        
        END IF;
        
      EXIT WHEN C_USUARIO%NOTFOUND;
    END LOOP;
  CLOSE C_USUARIO;
  
  RETURN VERIFICADOR;
  
END;
